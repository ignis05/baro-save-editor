import{p as e,a as t,V as a}from"./VTooltip.5b638740.js";import{v as s,i as r,T as o,f as i,o as n,n as l,w as c,b as d,P as m,t as u,U as p,a as f,m as h,F as y,Q as w,R as v,d as g,r as b}from"./vendor.32102158.js";import{D as k,a as x}from"./index.77fca062.js";import{c as _,b as D,e as C,f as j,a as A,g as V}from"./VRow.e59343f3.js";const W={data:()=>({workingDir:{name:null,handle:null},savesList:[]}),computed:{saveLocation:()=>e.windows?"C:\\Users\\%username%\\AppData\\Local\\Daedalic Entertainment GmbH\\Barotrauma":e.linux?"/home/$USER/.local/share/Daedalic Entertainment GmbH/":e.macos?"/$USER/Library/Application Support/Daedalic Entertainment GmbH/":"(unrecognized os)"},methods:{async selectWorkingDir(){try{var e=await window.showDirectoryPicker({id:"DecompressorWorkingDir",startIn:"desktop"})}catch(t){if(t instanceof TypeError)return this.$store.dispatch("showAlert",{type:"error",text:"Failed to use the File System API. It seems like it's not supported by your browser."});if(t instanceof DOMException)return;console.log("directory picker failed:"),console.error(t)}e&&(this.workingDir.name=e.name,this.workingDir.handle=e,this.scanWorkingDir(),this.$store.dispatch("showAlert",{type:"success",text:`Opened ${e.name} as the working directory.`}))},async scanWorkingDir(){let e=[];for await(const[t,a]of this.workingDir.handle.entries())if("file"===a.kind){if(t.endsWith(".save")){let s=e.find((e=>e.name==t.slice(0,-5)));s?s.compressed=a:e.push({name:t.slice(0,-5),compressed:a})}}else for await(const[s,r]of a.entries())if("file"===r.kind&&"gamesession.xml"==s){let s=e.find((e=>e.name==t));s?s.decompressed=a:e.push({name:t,decompressed:a})}this.savesList=e},async copyPath(){await navigator.clipboard.writeText(this.saveLocation),this.$store.dispatch("showAlert",{type:"success",text:"Copied save path to system clipboard."})},async decompress(e){let t=e.compressed;if(!t)return console.error("no saveFile - decompress button should not be reachable");let a=this.workingDir.handle;if(!a)return console.error("no workingDir - decompress button should not be reachable");if("granted"!==await a.queryPermission({mode:"readwrite"})&&"granted"!==await a.requestPermission({mode:"readwrite"}))return this.$store.dispatch("showAlert",{type:"error",text:"Failed get file system permissions."});let r=await t.getFile(),o=s.Buffer.from(await r.arrayBuffer()),i=k(o),n=e.decompressed;n||(n=await a.getDirectoryHandle(e.name,{create:!0}));for await(const[s,l]of n.entries())"file"===l.kind&&await n.removeEntry(s);for(let[s,l]of Object.entries(i)){let e=await n.getFileHandle(s,{create:!0}),t=await e.createWritable(),a=new Blob([l]);await t.write(a),await t.close()}this.scanWorkingDir(),this.$store.dispatch("showAlert",{type:"success",text:`Decompressed ${t.name}`})},async compress(e){let t=e.decompressed;if(!t)return console.error("no saveDir - decompress button should not be reachable");let a=this.workingDir.handle;if(!a)return console.error("no workingDir - decompress button should not be reachable");if("granted"!==await a.queryPermission({mode:"readwrite"})&&"granted"!==await a.requestPermission({mode:"readwrite"}))return this.$store.dispatch("showAlert",{type:"error",text:"Failed get file system permissions."});const r={};for await(const[c,d]of t.entries()){if("file"!==d.kind)continue;let e=await d.getFile(),t=s.Buffer.from(await e.arrayBuffer());r[c]=t}let o=x(r),i=new Blob([o.buffer],{type:"application/gzip"}),n=e.compressed;n||(n=await a.getFileHandle(t.name+".save",{create:!0}));let l=await n.createWritable();await l.write(i),await l.close(),this.scanWorkingDir(),this.$store.dispatch("showAlert",{type:"success",text:`Compressed ${e.name}`})}}},$=e=>(w("data-v-7b123cf0"),e=e(),v(),e),F=$((()=>m("div",{class:"text-white text-center text-h5"},"Simple save decompression and compression tools.",-1))),P={class:"text-center d-flex flex-row justify-center align-center"},S=g(" Your save files should be in "),B={class:"text-primary ml-2"},I=g(" mdi-clipboard-outline "),E=g("Copy path to clipboard"),H=$((()=>m("div",{class:"text-center mt-2"},[m("span",{class:"text-orange"},"Warning:"),g(" This tool uses experimental File System API - it might not work correctly in some browsers."),m("br"),g("It's also unable to access directories where some system files might be (this includes anything inside AppData directory - so you will need to copy the saves you want to decompress somewhere accessible). ")],-1))),L=g("Select working directory"),T={class:"d-flex justify-center align-center mb-4"},z={class:"mr-4 mb-0 text-white d-inline-flex text-h5 justify-center",style:{"min-width":"200px",border:"1px solid rgb(var(--v-theme-secondary))",padding:"2px","border-radius":"5px"}},R=g("mdi-folder-search-outline"),q=g("Select working directory"),U=g("mdi-folder-sync-outline"),G=g("Refresh directory"),O=g("Detected saves"),Y={class:"d-flex flex-column justify-start align-center mb-4"},M={style:{"font-size":"1.1em"}},Q=g("mdi-package-variant"),J=g("Decompress save"),K=g("mdi-package-variant-closed"),N=g("Compress save"),X=g(" How to use: "),Z={class:"pl-4 mb-2"},ee=$((()=>m("li",null,"Select a directory in a location accessible by the API (Desktop, Documents, etc.)",-1))),te=$((()=>m("li",null,"The tool will detect all compressed and decompressed saves directly in that selected directory",-1))),ae=g("mdi-package-variant"),se=g(" button decompresses the save"),re=g("mdi-package-variant-closed"),oe=g(" button compresses the save"),ie=g(" You can use "),ne=g("mdi-folder-sync-outline"),le=g(" to refresh the current directory or "),ce=g("mdi-folder-search-outline"),de=g(" to select a different one. "),me=g(" If file / directory with a matching name exists when compressing/decompressing the save, it will be overwritten. ");W.render=function(e,t,a,s,r,o){const i=b("v-icon"),w=b("v-tooltip"),v=b("v-card-text"),g=b("v-card"),k=b("v-col"),x=b("v-row"),_=b("v-card-header"),D=b("v-btn"),C=b("v-spacer"),j=b("v-container");return n(),l(j,null,{default:c((()=>[d(x,null,{default:c((()=>[d(k,null,{default:c((()=>[d(g,null,{default:c((()=>[d(v,{style:{opacity:"1"}},{default:c((()=>[F,m("div",P,[S,m("span",B,u(o.saveLocation),1),m("div",null,[d(i,{onClick:o.copyPath,color:"secondary",class:"iconButton ml-3"},{default:c((()=>[I])),_:1},8,["onClick"]),d(w,{anchor:"bottom",activator:"parent"},{default:c((()=>[E])),_:1})])]),H])),_:1})])),_:1})])),_:1})])),_:1}),d(x,null,{default:c((()=>[d(k,null,{default:c((()=>[d(g,null,{default:c((()=>[d(_,{class:"text-h4 justify-center"},{default:c((()=>[L])),_:1}),m("div",T,[m("div",z,u(r.workingDir.name||"none"),1),d(D,{color:"secondary",variant:"outlined",type:"icon",elevation:"1",onClick:o.selectWorkingDir},{default:c((()=>[d(i,{size:"large"},{default:c((()=>[R])),_:1}),d(w,{anchor:"bottom",activator:"parent"},{default:c((()=>[q])),_:1})])),_:1},8,["onClick"]),r.workingDir.handle?(n(),l(D,{key:0,class:"ml-2",color:"secondary",variant:"outlined",type:"icon",elevation:"1",onClick:o.scanWorkingDir},{default:c((()=>[d(i,{size:"large"},{default:c((()=>[U])),_:1}),d(w,{anchor:"bottom",activator:"parent"},{default:c((()=>[G])),_:1})])),_:1},8,["onClick"])):p("",!0)])])),_:1})])),_:1})])),_:1}),r.workingDir.handle?(n(),l(x,{key:0},{default:c((()=>[d(k,null,{default:c((()=>[d(g,null,{default:c((()=>[d(_,{class:"text-h5 justify-center"},{default:c((()=>[O])),_:1}),m("div",Y,[(n(!0),f(y,null,h(this.savesList,(e=>(n(),f("div",{key:e.name,style:{width:"400px"},class:"d-flex flex-row justify-center align-center my-1"},[m("div",M,u(e.name),1),d(C),d(D,{color:e.compressed?"secondary":"grey",disabled:!e.compressed,class:"mx-1",type:"icon",elevation:"1",variant:"outlined",onClick:t=>o.decompress(e)},{default:c((()=>[d(i,{size:"large"},{default:c((()=>[Q])),_:1}),d(w,{anchor:"bottom",activator:"parent"},{default:c((()=>[J])),_:1})])),_:2},1032,["color","disabled","onClick"]),d(D,{color:e.decompressed?"secondary":"grey",disabled:!e.decompressed,class:"mx-1",type:"icon",elevation:"1",variant:"outlined",onClick:t=>o.compress(e)},{default:c((()=>[d(i,{size:"large"},{default:c((()=>[K])),_:1}),d(w,{anchor:"bottom",activator:"parent"},{default:c((()=>[N])),_:1})])),_:2},1032,["color","disabled","onClick"])])))),128))])])),_:1})])),_:1})])),_:1})):p("",!0),d(x,null,{default:c((()=>[d(k,null,{default:c((()=>[d(g,{class:"d-flex align-center justify-center"},{default:c((()=>[d(v,{style:{opacity:"1"}},{default:c((()=>[X,m("ol",Z,[ee,te,m("li",null,[d(i,{color:"secondary"},{default:c((()=>[ae])),_:1}),se]),m("li",null,[d(i,{color:"secondary"},{default:c((()=>[re])),_:1}),oe]),m("li",null,[ie,d(i,{color:"secondary"},{default:c((()=>[ne])),_:1}),le,d(i,{color:"secondary"},{default:c((()=>[ce])),_:1}),de])]),me])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})},W.__scopeId="data-v-7b123cf0",r(W,"components",{VIcon:o,VTooltip:t,VCardText:_,VCard:D,VCol:C,VRow:j,VCardHeader:A,VBtn:i,VSpacer:a,VContainer:V});export{W as default};
